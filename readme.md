# Bitrix Docker

Базовая среда стека LAMP, созданная с использованием Docker Compose. Содержит в себе:

- `PHP`
- `Apache`
- `MySQL`
- `PhpMyAdmin`
- `Redis`
- `RabbitMQ`
- `MailHog`

Среда включает в себя следующие версии PHP:

- `PHP 8.3`
- `PHP 8.4`

---

## Установка

1. Склонировать репозиторий
2. Переименовать файл `example.env` в `.env`
3. Настроить .env
4. Запустить с помощью команды `docker compose up -d`

---

## Настройка и использование

### Общая информация

Данная сборка создана только для локального использования.

Сборка поставляется с параметрами конфигурации по умолчанию. Вы можете изменить параметры и переменные конфигурации в
файле `.env`

### Переменные конфигурации

### `PHP`

_**PHPVERSION**_

Используется для указания версии PHP, которую вы хотите использовать. По умолчанию всегда используется последняя версия
PHP.

_**PHP_INI**_

Используется кастомные модификации `php.ini` в соответствии с требованиями проекта.

### `Apache`

_**DOCUMENT_ROOT**_

Корневой каталог документов для сервера Apache. Значение по умолчанию - `./www`.

_**APACHE_DOCUMENT_ROOT**_

Значение файла конфигурации Apache. Значение по умолчанию - `/var/www/html`

_**VHOSTS_DIR**_

Настройка виртуальных хостов. Значение по умолчанию - `./config/vhosts`. Здесь можно разместить файлы виртуальных
хостов.

> Обязательно добавьте запись в файл `hosts` вашей системы для каждого созданного виртуального хоста.

_**APACHE_LOG_DIR**_

Используется для хранения логов Apache. По умолчанию - `./logs/apache2`.

### `База данных`

> Для пользователей Apple Silicon: используйте Mariadb в качестве базы данных. Oracle не создает свои SQL-контейнеры для
> архитектуры ARM

_**DATABASE**_

Определяет какая версия MySQL или MariaDB будет использована. Среда включает в себя следующие версии MySQL и MariaDB:

- `MySQL 8`
- `MariaDB 10.6`

_**MYSQL_INITDB_DIR**_

При первом запуске контейнера файлы в этом каталоге с расширениями `.sh`, `.sql`, `.sql.gz` и
`.sql.xz` будут выполняться в алфавитном порядке. Файлы `.sh` без разрешения на выполнение файлов берутся из источника,
а не выполняются.
Значение по умолчанию для этого параметра - `./config/initdb`.

_**MYSQL_DATA_DIR**_

Это каталог данных MySQL. Значение по умолчанию - `./data/mysql`. Все ваши файлы данных MySQL будут храниться здесь.

_**MYSQL_LOG_DIR**_

Диркутория для хранения логов. Значение по умолчанию - `./logs/mysql`.

### `Веб сервер`

Apache настроен на работу на 80 порту. Таким образом, вы можете получить к нему доступ через `http://localhost`.

#### Модули Apache

По умолчанию включены следующие модули:

- rewrite
- headers

> Если вы хотите включить больше модулей, просто обновите `./bin/phpX/Dockerfile`. Вы также можете создать MR для
> добавления необходимых модулей в репозиторий.
> После добавления новых модулей нужно пересобрать образ docker, запустив `docker compose build` и перезапустив
> контейнеры docker.

#### Модули PHP

По умолчанию установлены следующие расширения:

- `curl`
- `json`
- `ctype`
- `simplexml`
- `mysqli`
- `openssl`
- `sodium`
- `intl`
- `redis`
- `oci8`
- `libxml`
- `mbstring`
- `yaml`

> Если вы хотите включить больше модулей, просто обновите `./bin/phpX/Dockerfile`. Вы также можете создать MR для
> добавления необходимых модулей в репозиторий.
> После добавления новых модулей нужно пересобрать образ docker, запустив `docker compose build` и перезапустив
> контейнеры docker.

---

## phpMyAdmin

phpMyAdmin настроен на порт **8080**. Доступы:

`http://localhost:8080/`

**Пользователь:** `docker`

**Пароль:** `docker`

## RabbitMQ

RabbitMQ настроен на порт **15672**. Доступы:

`http://localhost:15672/`

**Пользователь:** `docker`

**Пароль:** `docker`

## MailHog

MailHog настроен на порт **8025**. Доступы:

`http://localhost:8025/`

**Пользователь:** `-`

**Пароль:** `-`

## Xdebug

Xdebug устанавливается по умолчанию, а его версия зависит от версии PHP, выбранной в файле `".env"`.
Для использования Xdebug необходимо включить настройки в файле `./config/php/php.ini`.

### Пример

```
xdebug.mode=develop,debug
xdebug.start_with_request=yes
xdebug.client_host=host.docker.internal
xdebug.discover_client_host=0
xdebug.client_port=9003
xdebug.idekey=PHPSTORM
```

**[Подробнее](https://www.jetbrains.com/help/phpstorm/configuring-xdebug.html)** про настройку Xdebug.

**[PHPStorm + XDebug + Docker](https://habr.com/ru/articles/712670/)**